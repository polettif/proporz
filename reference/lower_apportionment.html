<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Lower apportionment — lower_apportionment • proporz</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Lower apportionment — lower_apportionment"><meta name="description" content="In the second biproportional apportionment step, party and district divisors are calculated
such that the row and column sums of the resulting seats matrix satisfy the constraints
given by the upper apportionment."><meta property="og:description" content="In the second biproportional apportionment step, party and district divisors are calculated
such that the row and column sums of the resulting seats matrix satisfy the constraints
given by the upper apportionment."><meta property="og:image" content="https://polettif.github.io/proporz/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">proporz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/apportionment_scenarios.html">Apportionment scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/modifying_biproporz.html">Modifying biproporz()</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/polettif/proporz/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Lower apportionment</h1>
      <small class="dont-index">Source: <a href="https://github.com/polettif/proporz/blob/v1.5.2/R/biproportional-lower.R" class="external-link"><code>R/biproportional-lower.R</code></a></small>
      <div class="d-none name"><code>lower_apportionment.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In the second biproportional apportionment step, party and district divisors are calculated
such that the row and column sums of the resulting seats matrix satisfy the constraints
given by the upper apportionment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lower_apportionment</span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="va">seats_cols</span>, <span class="va">seats_rows</span>, method <span class="op">=</span> <span class="st">"round"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-votes-matrix">votes_matrix<a class="anchor" aria-label="anchor" href="#arg-votes-matrix"></a></dt>
<dd><p>matrix with votes by party in rows and votes by district in columns.</p></dd>


<dt id="arg-seats-cols">seats_cols<a class="anchor" aria-label="anchor" href="#arg-seats-cols"></a></dt>
<dd><p>number of seats per column (districts/regions), predetermined or
calculated with <code><a href="upper_apportionment.html">upper_apportionment()</a></code>.</p></dd>


<dt id="arg-seats-rows">seats_rows<a class="anchor" aria-label="anchor" href="#arg-seats-rows"></a></dt>
<dd><p>number of seats per row (parties/lists), calculated with
<code><a href="upper_apportionment.html">upper_apportionment()</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Apportion method that defines how seats are assigned. The
following methods are supported:</p><ul><li><p><code>round</code>: The default Sainte-Laguë/Webster method is the standard
for biproportional apportionment and the only method guaranteed to terminate.</p></li>
<li><p><code>wto</code>: "winner take one" works like <code>round</code> with a condition that the party that
got the most votes in a district must get <em>at least</em> one seat ('Majorzbedingung',
also called 'strongest party constrained' rule (SPC)). <code>votes_matrix</code> must have
row and column names to use this method.
A district winner can only get a seat if they are entitled to one from the upper
apportionment (<code>seats_rows</code>).
The condition does not apply in a district if two or more parties have the same
number of votes and there are not enough seats for these parties. A warning is
issued in this case. Modify the votes matrix to explicitly break ties.</p></li>
<li><p>You can provide a custom function that rounds a matrix (i.e. the
the <code>votes_matrix</code> divided by party and district divisors) without further
parameters.</p></li>
<li><p>It is possible to use any divisor method name listed in <code><a href="proporz.html">proporz()</a></code>.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A seat matrix with district (columns) and party (rows) divisors stored in
attributes.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The result is obtained by an iterative process ('Alternate Scaling Algorithm', see
Reference). Initially, for each district a divisor is chosen using the highest averages
method for the votes allocated to each regional party list in this region. For each party
a party divisor is initialized with 1.</p>
<p>Effectively, the objective of the iterative process is to modify the regional divisors
and party divisors so that the number of seats in each regional party list equals the
number of their votes divided by both the regional and the party divisors.</p>
<p>The following two correction steps are executed until this objective is satisfied:</p><ul><li><p>modify the party divisors such that the apportionment within each
party is correct with the chosen rounding method,</p></li>
<li><p>modify the regional divisors such that the apportionment within the
region is correct with the chosen rounding method.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If the maximum number of optimization iterations is reached, an error is thrown since
no solution can be found. You can overwrite the default (1000) with
<code>options(proporz_max_iterations = ...)</code> but it is very likely that the result is undefined
given the structure of the input parameters.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Oelbermann, K. F. (2016): Alternate scaling algorithm for biproportional
divisor methods. Mathematical Social Sciences, 80, 25-32.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="biproporz.html">biproporz()</a></code>, <code><a href="upper_apportionment.html">upper_apportionment()</a></code>, <code><a href="district_winner_matrix.html">district_winner_matrix()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">votes_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123</span>,<span class="fl">912</span>,<span class="fl">312</span>,<span class="fl">45</span>,<span class="fl">714</span>,<span class="fl">255</span>,<span class="fl">815</span>,<span class="fl">414</span>,<span class="fl">215</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">district_seats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">5</span>,<span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">party_seats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">11</span>,<span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lower_apportionment</span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="va">district_seats</span>, <span class="va">party_seats</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    4    4    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    2    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$districts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 204 180 162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$parties</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.2 1.0 1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using "winner take one"</span></span></span>
<span class="r-in"><span><span class="va">vm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">11</span><span class="op">)</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>            dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Party A"</span>, <span class="st">"Party B"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"II"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">district_seats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ua</span> <span class="op">=</span> <span class="fu"><a href="upper_apportionment.html">upper_apportionment</a></span><span class="op">(</span><span class="va">vm</span>, <span class="va">district_seats</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lower_apportionment</span><span class="op">(</span><span class="va">vm</span>, <span class="va">ua</span><span class="op">$</span><span class="va">district</span>, <span class="va">ua</span><span class="op">$</span><span class="va">party</span>, method <span class="op">=</span> <span class="st">"wto"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         I II</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party A 2  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party B 0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$districts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   I  II </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 144  31 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$parties</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party A Party B </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     0.7     2.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare to standard method</span></span></span>
<span class="r-in"><span><span class="fu">lower_apportionment</span><span class="op">(</span><span class="va">vm</span>, <span class="va">ua</span><span class="op">$</span><span class="va">district</span>, <span class="va">ua</span><span class="op">$</span><span class="va">party</span>, method <span class="op">=</span> <span class="st">"round"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         I II</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party A 1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party B 1  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$districts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   I  II </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150  21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"divisors")$parties</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Party A Party B </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     0.9     1.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Flavio Poletti.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


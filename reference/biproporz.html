<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Biproportional apportionment — biproporz • proporz</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Biproportional apportionment — biproporz"><meta property="og:description" content="Method to proportionally allocate seats among parties (or lists) and
districts (or entities, regions), thus bi-proportional."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">proporz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/polettif/proporz/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Biproportional apportionment</h1>
    <small class="dont-index">Source: <a href="https://github.com/polettif/proporz/blob/HEAD/R/biproportional.R" class="external-link"><code>R/biproportional.R</code></a></small>
    <div class="hidden name"><code>biproporz.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Method to proportionally allocate seats among parties (or lists) and
districts (or entities, regions), thus bi-proportional.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">biproporz</span><span class="op">(</span></span>
<span>  <span class="va">votes_matrix</span>,</span>
<span>  <span class="va">district_seats</span>,</span>
<span>  <span class="va">quorum</span>,</span>
<span>  use_list_votes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"round"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>votes_matrix</dt>
<dd><p>Vote count matrix with votes by party in rows
and votes by district in columns</p></dd>


<dt>district_seats</dt>
<dd><p>Vector defining the number of seats per district.
Must be the same length as <code>ncol(votes_matrix)</code>.
If the number of seats per district should be assigned
according to the number of votes (not the general use
case), a single number for the total number of seats
can be used.</p></dd>


<dt>quorum</dt>
<dd><p>Optional list of functions which take the votes_matrix and
return a logical vector that denotes for each list/party
whether they reached the quorum (i.e. are eligible for seats).
The easiest way to do this is via <code><a href="quorum_any.html">quorum_any()</a></code> or
<code><a href="quorum_all.html">quorum_all()</a></code>, see examples. Alternatively you can pass a
precalculated logical vector. No quorum is applied if parameter
is missing or <code>NULL</code>.</p></dd>


<dt>use_list_votes</dt>
<dd><p>By default (<code>TRUE</code>) it's assumed that each voter in a
district has as many votes as there are seats in a
district. Set to FALSE if <code>votes_matrix</code> shows the
number of voters.</p></dd>


<dt>method</dt>
<dd><p>Defines the method how seats in upper and lower apportionment
are assigned. For a different method for upper and lower
apportionment use a vector with two entries. The default
"round" for the Sainte-Laguë/Webster method is the standard for
biproportional apportionment and the only method guaranteed to
terminate. See <code><a href="proporz.html">proporz()</a></code> for other methods.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Matrix with the same dimension as <code>votes_matrix</code> containing
the number of seats with the row and column divisors stored in
attributes (hidden from print, see <code><a href="get_divisors.html">get_divisors()</a></code>).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Each party nominates a candidate list for every district. The voters vote
for the parties of their district. The seat allocation is calculated in two
steps:</p><ol><li><p>In the so called <em>upper apportionment</em> the number of seats for
each party (over all districts) is determined. Normally, the number of
seats for each region are defined before the election and are independent
of the vote counts.</p></li>
<li><p>In the so called <em>lower apportionment</em> the seats are distributed
to the regional party list respecting the results from the upper
apportionment.</p></li>
</ol><p>Parties failing to reach quorums cannot get seats.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>The iterative process in the lower apportionment is only guaranteed
to terminate with the default Sainte-Laguë/Webster method.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gaffke, Norbert; Pukelsheim, Friedrich (2008): Divisor methods
for proportional representation systems: An optimization approach
to vector and matrix apportionment problems. Mathematical Social
Sciences, 56 (2), 166–184.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="pukelsheim.html">pukelsheim()</a></code> for usage with data frames.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">votes_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">zug2018</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list_id"</span>, <span class="st">"entity_id"</span>, <span class="st">"list_votes"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">votes_matrix</span> <span class="op">=</span> <span class="fu"><a href="pivot_to_matrix.html">pivot_to_matrix</a></span><span class="op">(</span><span class="va">votes_df</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">distr_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">zug2018</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"entity_id"</span>, <span class="st">"election_mandates"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">district_seats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">distr_df</span><span class="op">$</span><span class="va">election_mandates</span>, <span class="va">distr_df</span><span class="op">$</span><span class="va">entity_id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">biproporz</span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="va">district_seats</span>, <span class="fu"><a href="quorum_any.html">quorum_any</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        entity_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> list_id 1701 1702 1703 1704 1705 1706 1707 1708 1709 1710 1711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       1    0    0    0    0    0    0    0    0    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2    2    1    1    0    0    0    1    2    1    0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       3    3    3    2    1    1    2    2    2    1    1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       4    2    2    1    1    0    1    2    1    1    1    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       5    1    1    0    0    0    0    0    0    0    0    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       6    3    1    1    0    0    0    0    0    1    0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       7    4    2    1    1    1    1    2    1    2    0    3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate quorum beforehand (leads to the same result as above)</span></span></span>
<span class="r-in"><span><span class="va">q1</span> <span class="op">=</span> <span class="fu"><a href="reached_quorum_any_district.html">reached_quorum_any_district</a></span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">q2</span> <span class="op">=</span> <span class="fu"><a href="reached_quorum_total.html">reached_quorum_total</a></span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="fl">0.03</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">reached_quorum</span> <span class="op">=</span> <span class="va">q1</span> <span class="op">|</span> <span class="va">q2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">biproporz</span><span class="op">(</span><span class="va">votes_matrix</span>, <span class="va">district_seats</span>, <span class="va">reached_quorum</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        entity_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> list_id 1701 1702 1703 1704 1705 1706 1707 1708 1709 1710 1711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       1    0    0    0    0    0    0    0    0    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2    2    1    1    0    0    0    1    2    1    0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       3    3    3    2    1    1    2    2    2    1    1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       4    2    2    1    1    0    1    2    1    1    1    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       5    1    1    0    0    0    0    0    0    0    0    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       6    3    1    1    0    0    0    0    0    1    0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       7    4    2    1    1    1    1    2    1    2    0    3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Different method for upper apportionment</span></span></span>
<span class="r-in"><span><span class="co"># and using number of voters instead of list votes</span></span></span>
<span class="r-in"><span><span class="va">f19_matrix</span> <span class="op">=</span> <span class="fu"><a href="pivot_to_matrix.html">pivot_to_matrix</a></span><span class="op">(</span><span class="va">finland2019</span><span class="op">$</span><span class="va">votes_df</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">f19_distr_seats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">finland2019</span><span class="op">$</span><span class="va">district_seats_df</span><span class="op">$</span><span class="va">election_mandates</span>,</span></span>
<span class="r-in"><span>    <span class="va">finland2019</span><span class="op">$</span><span class="va">district_seats_df</span><span class="op">$</span><span class="va">entity_id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f19_seats</span> <span class="op">=</span> <span class="fu">biproporz</span><span class="op">(</span><span class="va">f19_matrix</span>, <span class="va">f19_distr_seats</span>,</span></span>
<span class="r-in"><span>               use_list_votes <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>               method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"floor"</span>, <span class="st">"round"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f19_seats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">f19_seats</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        entity_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> list_id HAEM HEL KAA KES LAP OUL PIR SAT SKA UUS VAA VAR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    KD      1   0   1   1   0   1   1   0   1   1   1   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    KESK    1   1   3   2   2   6   2   1   3   2   3   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    KOK     3   5   3   1   1   2   4   1   2   7   2   4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    NYT     0   1   0   0   0   0   0   0   0   0   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Nyt     0   0   0   0   0   0   0   0   0   1   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    PIR     0   1   0   0   0   0   0   0   0   0   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    PS      3   3   3   2   1   4   3   2   3   6   3   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    RKP     0   1   0   0   0   0   0   0   0   4   3   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    SDP     4   3   4   2   1   2   4   2   3   7   2   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    SIN     0   0   0   0   0   0   0   0   1   1   0   0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    VAS     1   2   1   1   1   2   2   1   1   2   1   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    VIHR    1   5   2   1   1   1   3   1   1   5   1   2</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Flavio Poletti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

